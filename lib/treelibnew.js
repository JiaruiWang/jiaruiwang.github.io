var vizuly={};vizuly.version="1.0",vizuly.viz={},vizuly.viz.layout={},vizuly.viz.layout.CLUSTERED="CLUSTERED",vizuly.viz.layout.STACKED="STACKED",vizuly.viz.layout.OVERLAP="OVERLAP",vizuly.viz.layout.STREAM="STREAM",vizuly.theme={},vizuly.skin={},vizuly.color={},vizuly.color.shift=function(a,b){return a="0x"+a.replace("#",""),a=parseInt(a,16),a+=65793,a|=b,"#"+a.toString(16)},vizuly.component={},vizuly.component.create=function(a,b,c,d){b.parent=a,b.properties=c,b.id=vizuly.util.guid(),b.selection=d3.select(a).append("div").attr("id","div_"+b.id).style("width","100%").style("height","100%");var e=[];e.push("mouseover"),e.push("mouseout"),e.push("mousedown"),e.push("click"),e.push("dblclick"),e.push("touch"),e.push("zoom"),e.push("zoomstart"),e.push("zoomend"),e.push("initialize"),e.push("validate"),e.push("measure"),e.push("update"),Object.getOwnPropertyNames(c).forEach(function(a,b,c){e.push(a+"_change")}),d&&d.length>0&&d.forEach(function(a){e.push(a)}),b.dispatch=d3.dispatch.apply(this,e);var f=function(){return setProps(f,b,b.properties),f};return setProps=function(a,b,c){Object.getOwnPropertyNames(c).forEach(function(d,e,f){"undefined"==typeof b[d]&&(b[d]=c[d],a[d]=function(c){if(!arguments.length)return b[d];var e=b[d];return b[d]=c,b[d]!==e&&b.dispatch[d+"_change"].apply(this,[b[d],e]),a})})},f.id=function(){return b.id},f.selection=function(){return b.selection},f.on=function(a,c){return b.dispatch.on(a,c),f},f.validate=function(){if(!a){var a=[];if(Object.getOwnPropertyNames(c).forEach(function(c){!b[c]&&Number(0!=b[c])&&a.push(c)}),a.length>0)throw new Error("vizuly.util.component.validate(): "+a.concat()+" need to be declared");b.dispatch.validate()}},b.dispatch.component=f(),b.dispatch.component},vizuly.data={},vizuly.data.aggregateNest=function(a,b,c){function f(a,b){if(b)for(var c=0;c<e.length;c++){var d=e[c];void 0!=a[d]&&(a["childProp_"+d]=a[d]),b["childProp_"+d]=a["childProp_"+d]?a["childProp_"+d]:a[d]}}function g(a,d){for(var e=0;e<a.length;e++){var h=a[e];if(h.values){g(h.values,h);for(var i=0;i<h.values.length;i++)for(var j=h.values[i],k=0;k<b.length;k++)isNaN(h["agg_"+b[k]])&&(h["agg_"+b[k]]=0),h["agg_"+b[k]]=c(h["agg_"+b[k]],j["agg_"+b[k]])}else for(var k=0;k<b.length;k++)h["agg_"+b[k]]=Number(h[b[k]]),isNaN(h["agg_"+b[k]])&&(h["agg_"+b[k]]=0);f(h,d)}}for(var d=a[0];d.values;)d=d.values[0];var e=[];Object.getOwnPropertyNames(d).forEach(function(a){e.push(a)}),g(a)},vizuly.format={},vizuly.format.YEAR_Mon_MonDay=d3.time.format.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%I:%M",function(a){return a.getMinutes()}],["%I %p",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getDate()}],["%b",function(a){return a.getMonth()}],["20%y",function(a){return!0}]]),vizuly.util={},vizuly.util.size=function(a,b,c){return size={},size.width=b-vizuly.util.measure(a.left,b)-vizuly.util.measure(a.right,b),size.height=c-vizuly.util.measure(a.top,c)-vizuly.util.measure(a.bottom,c),size.top=vizuly.util.measure(a.top,c),size.left=vizuly.util.measure(a.left,b),size},vizuly.util.getTypedScale=function(a){var b;return b="string"==typeof a?d3.scale.ordinal():a instanceof Date?d3.time.scale():d3.scale.linear()},vizuly.util.setRange=function(a,b,c){"string"==typeof a.domain()[0]?a.rangeBands([b,c],0):a.range([b,c])},vizuly.util.measure=function(a,b){if("string"==typeof a&&"%"==a.substr(a.length-1)){var c=Math.min(Number(a.substr(0,a.length-1)),100)/100;return Math.round(b*c)}return a},vizuly.util.guid=function(){return"vzxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},vizuly.util.getDefs=function(a){return defs=a.selection().selectAll("svg defs"),defs[0].length<1&&(defs=a.selection().select("svg").append("defs")),defs},vizuly.util.createCSSKey=function(a){return a=String(a).replace(",","_"),a=a.replace(/[\s+,'+,\.,\(,\),\"]/g,""),a="css"+a.toUpperCase()},vizuly.svg={},vizuly.svg.filter={},vizuly.svg.filter.dropShadow=function(a,b,c,d){var e=Math.round(100*b)+"_"+Math.round(100*c)+"_"+Math.round(100*d),f=a.id(),g=vizuly.util.getDefs(a),h=g.selectAll("#vz_filter_"+f+"_"+e).data([e]).enter().append("filter").attr("id","vz_filter_"+f+"_"+e).attr("class","vz-svg-filter-dropShadow").attr("width","300%").attr("height","300%");h.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",d),h.append("feOffset").attr("dx",b).attr("dy",c),h.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope",.2);var i=h.append("feMerge");return i.append("feMergeNode"),i.append("feMergeNode").attr("in","SourceGraphic"),"#vz_filter_"+f+"_"+e},vizuly.svg.gradient={},vizuly.svg.gradient.blend=function(a,b,c,d){var g,h,i,j,e=String(b).replace("#","")+String(c).replace("#",""),f="vz_gradient_blend_"+a.id()+"_"+e;"horizontal"==d?(g="100%",h="0%",i="0%",j="0%"):(g="0%",h="0%",i="100%",j="0%");var k=vizuly.util.getDefs(a),l=k.selectAll("#"+f).data([e]).enter().append("linearGradient").attr("id",f).attr("class","vz-svg-gradient-blend").attr("x1",g).attr("x2",h).attr("y1",i).attr("y2",j);return l.append("stop").attr("offset","0%").attr("stop-color",b),l.append("stop").attr("offset","100%").attr("stop-color",c),l=k.selectAll("#"+f)},vizuly.svg.gradient.fade=function(a,b,c,d,e){e||(e=[0,1]),d||(d=[.75,.9]);var h,i,j,k,f=String(b).replace("#",""),g="vz_gradient_fade_"+a.id()+"_"+f;"horizontal"==c?(h="0%",i="100%",j="0%",k="0%"):(h="0%",i="0%",j="100%",k="0%");var l=vizuly.util.getDefs(a),m=l.selectAll("#"+g).data([f]).enter().append("linearGradient").attr("id",g).attr("class","vz-svg-gradient-fade").attr("x1",h).attr("x2",i).attr("y1",j).attr("y2",k);return m.append("stop").attr("offset",100*e[0]+"%").attr("stop-color",b).attr("stop-opacity",d[0]),m.append("stop").attr("offset",100*e[1]+"%").attr("stop-color",b).attr("stop-opacity",d[1]),m=l.selectAll("#"+g)},vizuly.svg.gradient.radialFade=function(a,b,c,d){d||(d=[0,1]),c||(c=[.75,.9]);var e=String(b).replace("#",""),f="vz_gradient_radial_fade"+a.id()+"_"+e,g=vizuly.util.getDefs(a),h=g.selectAll("#"+f).data([e]).enter().append("radialGradient").attr("id",f).attr("class","vz-svg-gradient-radial-fade");return h.append("stop").attr("offset",100*d[0]+"%").attr("stop-color",b).attr("stop-opacity",c[0]),h.append("stop").attr("offset",100*d[1]+"%").attr("stop-color",b).attr("stop-opacity",c[1]),h=g.selectAll("#"+f)},vizuly.svg.gradient.darker=function(a,b,c){var f,g,h,i,d=String(b).replace("#",""),e="vz_gradient_darker_"+a.id()+"_"+d;"horizontal"==c?(f="100%",g="0%",h="0%",i="0%"):(f="0%",g="0%",h="100%",i="0%");var j=vizuly.util.getDefs(a),k=j.selectAll("#"+e).data([d]).enter().append("linearGradient").attr("class","vz-gradient-darker").attr("id",e).attr("x1",f).attr("x2",g).attr("y1",h).attr("y2",i);return k.append("stop").attr("offset","0%").attr("stop-color",b).attr("stop-opacity",.75),k.append("stop").attr("offset","100%").attr("stop-color",d3.rgb(b).darker()).attr("stop-opacity",.9),k=j.selectAll("#"+e)},vizuly.viz.weighted_tree=function(a){function A(){b.selection.attr("class","vz-weighted_tree-viz"),s=b.selection.append("svg").attr("id",b.id).style("overflow","visible").attr("class","vizuly vz-weighted_tree-viz"),z=vizuly.util.getDefs(d),u=s.append("rect").attr("class","vz-background"),t=s.append("g").attr("class","vz-weighted_tree-viz"),v=t.append("g").attr("class","vz-weighted_tree-plot").attr("clip-path","url(#"+b.id+"_plotClipPath)"),w=v.append("rect").attr("class","vz-plot-background"),x=v.append("g").attr("class","vz-weighted_tree-link-plot"),y=v.append("g").attr("class","vz-weighted_tree-node-plot"),b.dispatch.initialize()}function B(){function a(b){b.children&&(b._children=b.children,b._children.forEach(a),b.children=null)}d.validate(),h=vizuly.util.size(b.margin,b.width,b.height),i.size([h.height,h.width]),(1==e||f)&&(C(),1==e&&k.children.forEach(a),e=!1,f=!1);var c;c=b.branchPadding==-1?Math.min(h.height,h.width)/b.children(b.data).length:Math.min(h.height,h.width)*b.branchPadding,j.range([1.5,c/2]),i.nodeSize([c,0]),m=b.fixedSpan>0?b.fixedSpan:h.width/(n+1);for(var g=1;g<n+1;g++){var q=l.filter(function(a){return a.depth==g});o[g]=d3.max(q,function(a){return b.value(a)}),p[g]=d3.min(q,function(a){return b.value(a)})}i.sort(function(a,c){return b.label(a)>b.label(c)?1:b.label(a)<b.label(c)?-1:0}),b.dispatch.measure()}function C(){function a(c){b.children(c)&&(c._children||(c.children=b.children(c),c.children.forEach(function(b){b.x0=c.x,b.y0=c.y,a(b)})))}n=0,a(b.data),k=b.data,k.x0=0,k.y0=0,l=i.nodes(k).reverse(),l.forEach(function(a){0!=a.depth&&(o[a.depth]||(o[a.depth]=-(1/0),p[a.depth]=1/0),n=Math.max(n,a.depth))}),b.dispatch.data_prepped()}function D(){e=!0}function E(a){B(),s.attr("width",b.width).attr("height",b.height),u.attr("width",b.width).attr("height",b.height),v.style("width",h.width).style("height",h.height).attr("transform","translate("+h.left+","+(h.top+h.height/2)+")"),F(k)}function F(a){var c=i(k).reverse(),d=i.links(c);G(a,c);var e=y.selectAll(".vz-weighted_tree-node").data(c,function(a){return a.vz_tree_id||(a.vz_tree_id=b.key(a))}),f=e.enter().append("g").attr("class",function(a){return"vz-weighted_tree-node vz-id-"+a.vz_tree_id}).attr("transform",function(b){var c=b.y0?b.y0:a.y0,d=b.x0?b.x0:a.x0;return"translate("+c+","+d+")"}).on("click",function(a,c){b.dispatch.click(this,a,c)}).on("dblclick",function(a,c){b.dispatch.dblclick(this,a,c)}).on("mouseover",function(a,c){b.dispatch.mouseover(this,a,c)}).on("mouseout",function(a,c){b.dispatch.mouseout(this,a,c)});f.append("circle").attr("class",".vz-weighted_tree-node-circle").attr("r",1e-6).style("cursor","pointer"),f.append("text").attr("x",function(a){return a.children||a._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(a){return a.children||a._children?"end":"start"}).style("pointer-events","none").text(function(a){return b.label(a)});var g=x.selectAll(".vz-weighted_tree-link").data(d,function(a){return a.target.vz_tree_id});g.enter().append("path").attr("class",function(a){return"vz-weighted_tree-link vz-id-"+a.target.vz_tree_id}).attr("d",function(b){var c=b.target.y0?b.target.y0:a.y0,d=b.target.x0?b.target.x0:a.x0,e={x:d,y:c};return q({source:e,target:e})}).on("mouseover",function(a,c){b.dispatch.mouseover(this,a,c)}).on("mouseout",function(a,c){b.dispatch.mouseout(this,a,c)}).style("stroke-linecap","round"),b.dispatch.update();var h=e.transition();H(h,function(){b.dispatch.node_refresh()}),h.duration(b.duration).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}),h.select("circle").attr("r",function(a){return r(a)});var j=e.exit().transition().duration(b.duration).attr("transform",function(b){return b.x0=null,b.y0=null,"translate("+a.y+","+a.x+")"}).remove();j.select("circle").attr("r",1e-6),j.select("text"),g.transition().duration(b.duration).attr("d",q).style("stroke-width",function(a){return 2*r(a.target)}),g.exit().transition().duration(b.duration).attr("d",function(b){var c={x:a.x,y:a.y};return q({source:c,target:c})}).remove(),c.forEach(function(a){a.x0=a.x,a.y0=a.y})}function G(a,c){var d=d3.min(c,function(a){return a.x}),e=d3.max(c,function(a){return a.x}),f=d3.max(c,function(a){return a.depth})*m,g=Math.max(b.height,e-d+h.top),j=Math.max(b.width,f+.2*b.width+h.left);h.height/2+e>g&&(g=h.height/2+e+i.nodeSize()[0]),s.transition().duration(b.duration).style("height",g+"px").style("width",j+"px");var k=Math.max(0,-d-h.height/2)+i.nodeSize()[0]/2;c.forEach(function(a){a.y=a.depth*m,a.x=a.x+k-i.nodeSize()[0]}),I(a.x)}function H(a,b){var c=0;a.each(function(){++c}).each("end",function(){--c||b.apply(this,arguments)})}function I(a){function c(a){return function(){var b=d3.interpolateNumber(this.scrollTop,a);return function(a){this.scrollTop=b(a)}}}b.selection.transition().duration(b.duration).tween("scrolltween",c(a))}function J(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null),F(a)}var b={},c={data:null,margin:{top:"5%",bottom:"5%",left:"8%",right:"7%"},key:null,tree:d3.layout.tree(),children:null,duration:500,width:300,height:300,value:null,branchPadding:-1,fixedSpan:-1,label:function(a,b){return a}},d=vizuly.component.create(a,b,c,["node_refresh","data_prepped"]);d.type="viz.chart.weighted_tree";var e=!0,f=!1;d.on("data_change.internal",D);var h,k,l,m,n,s,t,u,v,w,x,y,z,i=b.tree,j=d3.scale.sqrt(),o={},p={},q=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),r=function(a){return 0==a.depth?j.range()[1]/2:(j.domain([p[a.depth],o[a.depth]]),j(b.value(a)))};return A(),d.update=function(a){return 1==a&&(f=!0),E(),d},d.toggleNode=function(a){J(a)},d},vizuly.theme.weighted_tree=function(a){function g(){m()}function h(){if(o){var b=a.selection();c=Math.max(8,Math.round(a.width()/75)),b.selectAll(".vz-weighted_tree-node circle").style("stroke",function(a){return o.node_stroke(a)}).style("stroke-opacity",function(a){return o.node_stroke_opacity(a)}).style("fill",function(a){return o.node_fill(a)}).style("fill-opacity",function(a){return o.node_fill_opacity(a)}),b.selectAll(".vz-weighted_tree-node text").style("font-size",o.font_size()).style("fill",o.label_color).style("fill-opacity",function(a){return o.text_fill_opacity(a)}),b.selectAll(".vz-weighted_tree-link").style("stroke",function(a){return o.link_stroke(a)}).style("stroke-opacity",function(a){return o.link_stroke_opacity(a)})}}function i(){if(o&&a.data()){var b=a.data();a.children()(b).forEach(function(a,b){a.vz_link_color=AgenColor(a.key),j(a)}),d=!1,e=!1}}function j(b){a.children()(b)&&a.children()(b).forEach(function(a){a.vz_link_color=b.vz_link_color,j(a)})}function k(b,d,e){var f=a.selection();f.selectAll(".vz-id-"+d.vz_tree_id+" circle").style("fill-opacity",.9),f.selectAll("path.vz-id-"+d.vz_tree_id).style("stroke-opacity",.8),f.selectAll(".vz-id-"+d.vz_tree_id+" text").transition().style("font-size",1.25*c).style("font-weight","bold")}function l(b,d,e){var f=a.selection();f.selectAll(".vz-weighted_tree-node circle").style("fill",function(a){return o.node_fill(a)}).style("fill-opacity",function(a){return o.node_fill_opacity(a)}),f.selectAll(".vz-weighted_tree-node text").transition().style("font-size",c).style("font-weight","normal"),f.selectAll(".vz-weighted_tree-link").style("stroke-opacity",function(a){return o.link_stroke_opacity(a)})}function m(){f.forEach(function(b){a.on(b.on,b.callback)})}function n(){f.forEach(function(b){a.on(b.on,null)})}var c,b={Axiis:{name:"Axiis",label_color:"#333",link_colors:["#5254a3","#9c9ede","#8ca252","#b5cf6b","#bd9e39","#cedb9c","#d6616b","#e7ba52","#ad494a","#e7969c","#ce6dbd","#3182bd","#de9ed6","#9ecae1","#e6550d","#fd8d3c","#fdd0a2","#31a354","#a1d99b","#9e9ac8","#969696","#d62728","#e377c2","#9467bd"],link_stroke:function(a,b){return a.target.vz_link_color},link_stroke_opacity:function(a,b){return.6},node_fill:function(a,b){return a.vz_link_color},node_fill_opacity:function(a,b){return.8},node_stroke:function(a,b){return a.vz_link_color},node_stroke_opacity:function(a,b){return 1},text_fill_opacity:function(b,c){return a.value()(b)<=0?.35:1},font_size:function(){return c+"px"}},None:{name:"None",label_color:null,link_colors:["#bd0026","#fecc5c","#fd8d3c","#f03b20","#B02D5D","#9B2C67","#982B9A","#692DA7","#5725AA","#4823AF","#d7b5d8","#dd1c77","#5A0C7A","#5A0C7A"],link_stroke:function(a,b){return null},link_stroke_opacity:function(a,b){return null},node_fill:function(a,b){return null},node_fill_opacity:function(a,b){return null},node_stroke:function(a,b){return null},node_stroke_opacity:function(a,b){return null},text_fill_opacity:function(a,b){return null},font_size:function(){return null}}},a=a,d=!0,e=!0,f=[{on:"update.theme",callback:h},{on:"data_prepped.theme",callback:i},{on:"mouseover.theme",callback:k},{on:"mouseout.theme",callback:l}];g(),g.apply=function(a){return arguments.length>0&&g.skin(a),h(),g},g.release=function(){a&&(o=b.None,h(),n(),a=null)},g.viz=function(b){return arguments.length?(a&&n(),a=b,void m()):a},g.skin=function(a){if(0==arguments.length)return o;if(!b[a])throw new Error("theme/weightedtree.js - skin "+a+" does not exist.");return d=!0,o=b[a],g},g.skins=function(){return b};var o=b[vizuly.skin.WEIGHTED_TREE_AXIIS];return g},vizuly.skin.WEIGHTED_TREE_AXIIS="Axiis";